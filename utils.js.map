{"version":3,"sources":["src/utils.es6"],"names":["unescapeHtmlEntities","pause","splitArray","abridge","getCacheableImage","findContentImage","getContentImage","text","temp","document","createElement","innerHTML","innerText","textContent","ms","setTimeout","resolve","array","chunksNumber","newArray","i","push","undefined","length","chunkLength","Math","ceil","forEach","item","chunkNumber","floor","Error","slice","words","split","replace","join","initialImageURL","imageWidth","thumbnail","jiveStorageResult","match","imageNumberChunks","imageID","contentItem","defaultImageURL","mode","contentImages","ref","jQuery","$","content","find","attr","images","options","defaultOptions","utils"],"mappings":"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","file":"utils.js","sourcesContent":["import jQuery from 'jive/jquery'\n\nexport function unescapeHtmlEntities(text) {\n    const temp = document.createElement('div')\n    temp.innerHTML = text\n    return temp.innerText || temp.textContent\n}\n\nexport function pause(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nexport function splitArray(array, chunksNumber) {\n    const newArray = []\n\n    for (let i = 0; i < chunksNumber; i++) {\n        newArray.push([])\n    }\n\n    if (array !== undefined && array.length) {\n        const chunkLength = Math.ceil(array.length / chunksNumber)\n\n        array.forEach((item, i) => {\n            const chunkNumber = Math.floor(i / chunkLength)\n            newArray[chunkNumber].push(item)\n        })\n    }\n\n    return newArray\n}\n\nexport function abridge(text, length = 160) {\n\n    if (typeof text !== 'string') {\n        throw new Error(`\"abridge\" 1st argument must be a string (${typeof text} given)`)\n    }\n\n    //if it's less than limit - just return it\n    if (text.length <= length) return text\n\n    //cut text\n    text = text.slice(0, length)\n\n    let words = text.split(' ')\n\n    //remove last word (cause it can be broken, or too long in case of a link)\n    if (words.length > 1) {\n        words = words.slice(0, words.length - 1)\n    }\n\n    // remove commas and dots from a last word\n    words[words.length - 1] = words[words.length - 1].replace(/\\.|,/gi, '')\n\n    return words.join(' ') + '...'\n}\n\nexport function getCacheableImage(initialImageURL, imageWidth = 500, thumbnail = false) {\n\n    //return initialImageURL\n    if (!initialImageURL) return initialImageURL\n\n    const jiveStorageResult =\n        initialImageURL.match(/(.+)servlet\\/JiveServlet\\/(downloadImage|previewBody)\\/([\\d-]+)\\/(.+)/i)\n\n    //console.log('jiveStorageResult', jiveStorageResult)\n\n    if (!jiveStorageResult || !jiveStorageResult[3]) return initialImageURL\n\n    //get jive image ID from URL\n    const imageNumberChunks = jiveStorageResult[3].split('-')\n    const imageID = imageNumberChunks[imageNumberChunks.length - 1]\n\n    switch (jiveStorageResult[2]){\n        case 'downloadImage':\n            return jiveStorageResult[1]\n                + 'api/core/v3/images/' + imageID + '?width=' + imageWidth\n                + (thumbnail ? '&thumbnail=true' : '')\n        case 'previewBody':\n            return jiveStorageResult[1]\n                + 'servlet/JiveServlet?bodyImage=true&contentType=image&maxWidth=500&maxHeight=300'\n                + '&binaryBodyID=' + imageID\n    }\n}\n\nexport function findContentImage(contentItem, defaultImageURL, mode = 'regexp') {\n\n    switch (mode) {\n        case 'api':\n            // version 1: take from API. Downside: API images list never updates after content creation\n            if (contentItem.contentImages && contentItem.contentImages.length) {\n                return contentItem.contentImages[0].ref\n            }\n            return defaultImageURL\n        case 'jquery':\n            //version 2: find image links with jQuery. Downside: it requests all the images content item has\n            return jQuery ? ($(contentItem.content.text).find('img').attr('src') || defaultImageURL) : defaultImageURL\n        case 'regexp':\n            //version 3: Find image URLs by regExp\n            const images = contentItem.content.text.match(/<img[^>]*src=[\"']?([^>\"']+)[\"']?[^>]*>/im)\n            return (images && images[1]) ? images[1] : defaultImageURL\n        default:\n            return defaultImageURL\n    }\n}\n\nexport function getContentImage(contentItem, options){\n\n    const defaultOptions = {\n        imageWidth: 500,\n        defaultImageURL: '',\n        mode: 'regexp',\n        thumbnail: false\n    }\n\n    options = {\n        ...defaultOptions,\n        ...options\n    }\n\n    const {imageWidth, defaultImageURL, mode, thumbnail} = options\n\n    return getCacheableImage(findContentImage(contentItem, defaultImageURL, mode), imageWidth, thumbnail)\n}\n\n\nconst utils = {\n    pause,\n    unescapeHtmlEntities,\n    splitArray,\n    abridge,\n    getCacheableImage,\n    findContentImage,\n    getContentImage\n}\n\nexport default utils"]}