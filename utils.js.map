{"version":3,"sources":["src/utils.es6"],"names":["unescapeHtmlEntities","pause","splitArray","sliceArray","abridge","getCacheableImage","findContentImage","getImagelessHTML","getContentImage","jsonCopy","isEmptyObject","jQuery","window","text","Error","temp","document","createElement","innerHTML","innerText","textContent","ms","setTimeout","resolve","array","chunksNumber","Array","newArray","i","push","undefined","length","chunkLength","Math","ceil","forEach","item","chunkNumber","floor","sliceSize","sourceArray","targetArrayOfArrays","splice","newText","slice","match","words","split","join","replace","initialImageURL","imageWidth","thumbnail","jiveStorageResult","imageNumberChunks","imageID","contentItem","mode","fallback","content","includes","image","getFromApi","contentImages","ref","thumbnailURL","find","attr","images","htmlText","options","defaultOptions","obj","JSON","parse","error","console","utils"],"mappings":"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","file":"utils.js","sourcesContent":["import 'core-js/fn/array/includes'\n\nconst jQuery = window.jQuery\n\nexport function unescapeHtmlEntities(text) {\n    if(typeof text !== 'string') throw new Error('Argument should be a string')\n\n    const temp = document.createElement('div')\n    temp.innerHTML = text //.replace(/<|&lt;/gi, '‹').replace(/>|&gt;/gi, '›')\n    return temp.innerText || temp.textContent\n}\n\nexport function pause(ms=0) {\n    if (typeof ms !== 'number') throw new Error('Expected parameter to be a number')\n    if (ms < 0) throw new Error(\"We can't do time travel :) Please input a positive number or 0\")\n\n    return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nexport function splitArray(array, chunksNumber) {\n    if (!(array instanceof Array)) throw new Error ('1st argument should be an array')\n    if (typeof chunksNumber !== 'number') throw new Error ('2nd argument should be a number')\n    if (chunksNumber <= 0) return []\n    if (chunksNumber === 1) return array\n\n    const newArray = []\n\n    for (let i = 0; i < chunksNumber; i++) {\n        newArray.push([])\n    }\n\n    if (array !== undefined && array.length) {\n        const chunkLength = Math.ceil(array.length / chunksNumber)\n\n        array.forEach((item, i) => {\n            const chunkNumber = Math.floor(i / chunkLength)\n            newArray[chunkNumber].push(item)\n        })\n    }\n\n    return newArray\n}\n\nexport function sliceArray (array, sliceSize) {\n  if (!(array instanceof Array)) throw new Error ('1st argument should be an array')\n  if (typeof sliceSize !== 'number') throw new Error ('2nd argument should be a number')\n  if (sliceSize <= 0) throw new Error ('2nd argument should 1 or more')\n  if (sliceSize >= array.length) return [array]\n\n  const sourceArray = [...array]\n  const targetArrayOfArrays = []\n\n  while (sourceArray.length) {\n    targetArrayOfArrays.push(sourceArray.splice(0, sliceSize))\n  }\n\n  return targetArrayOfArrays\n}\n\nexport function abridge(text, length = 160) {\n\n    if (typeof text !== 'string') {\n        throw new Error(`\"abridge\" 1st argument must be a string (${typeof text} given)`)\n    }\n\n    //if it's less than limit - just return it\n    if (text.length <= length) return text\n\n    let newText = text.slice(0, length)\n\n    // if the next symbol is not a whitespace and not a punctuation - remove last word\n    if (!text[length].match(/\\s|\\.|,|:|;|!|\\?/)) {\n\n        let words = newText.split(' ')\n\n        //remove last word (cause it can be broken, or too long in case of a link)\n        if (words.length > 1) {\n            words = words.slice(0, words.length - 1)\n        }\n\n        newText = words.join(' ')\n    }\n\n    // remove commas and dots from a last word\n    newText = newText.replace(/(\\.|,|;|:)$/, '')\n\n    return newText + '...'\n}\n\nexport function getCacheableImage(initialImageURL, imageWidth = 500, thumbnail = false) {\n\n    //return initialImageURL\n    if (!initialImageURL) return initialImageURL\n\n    if (typeof initialImageURL !== 'string') {\n        throw new Error ('1st argument should be falsy value or string')\n    }\n    if (typeof imageWidth !== 'undefined' && typeof imageWidth !== 'number'){\n        throw new Error ('2nd argument should be a number if defined')\n    }\n\n    const jiveStorageResult =\n        initialImageURL.match(/(.+)servlet\\/JiveServlet\\/(downloadImage|previewBody)\\/([\\d-]+)\\/(.+)/i)\n\n    //console.log('jiveStorageResult', jiveStorageResult)\n\n    if (!jiveStorageResult || !jiveStorageResult[3]) return initialImageURL\n\n    //get jive image ID from URL\n    const imageNumberChunks = jiveStorageResult[3].split('-')\n    const imageID = imageNumberChunks[imageNumberChunks.length - 1]\n\n    switch (jiveStorageResult[2]){\n        case 'downloadImage':\n            return jiveStorageResult[1]\n                + 'api/core/v3/images/' + imageID + '?width=' + imageWidth\n                + (thumbnail ? '&thumbnail=true' : '')\n        case 'previewBody':\n            return jiveStorageResult[1]\n                + 'servlet/JiveServlet?bodyImage=true&contentType=image&maxWidth=500&maxHeight=300'\n                + '&binaryBodyID=' + imageID\n    }\n}\n\nexport function findContentImage(contentItem, mode = 'regexp', fallback = true) {\n\n    if (!contentItem || !contentItem.content || !contentItem.content.text) return null\n\n    if (typeof mode !== 'undefined' && !['regexp', 'api', 'jquery'].includes(mode)) {\n        throw new Error('2nd argument should be \"regexp\"|\"api\"|\"jquery\"')\n    }\n\n    let image\n\n    function getFromApi(){\n        if (contentItem.contentImages && contentItem.contentImages.length) {\n            return contentItem.contentImages[0].ref\n        } else if (contentItem.thumbnailURL) {\n            return contentItem.thumbnailURL\n        }\n        return false\n    }\n\n    switch (mode) {\n        case 'api':\n            // version 1: take from API. Downside: API images list never updates after content creation\n            image = getFromApi()\n            break\n        case 'jquery':\n            //version 2: find image links with jQuery. Downside: it requests all the images content item has\n            image = jQuery ? jQuery(contentItem.content.text).find('img').attr('src') : false\n            break\n        case 'regexp':\n            //version 3: Find image URLs by regExp\n            const images = contentItem.content.text.match(/<img[^>]*src=[\"']?([^>\"']+)[\"']?[^>]*>/im)\n            image = (images && images[1]) ? images[1] : false\n            break\n    }\n\n    if (!image && mode !== 'api' && fallback) {\n        image = getFromApi()\n    }\n\n    return image\n}\n\nexport function getImagelessHTML(htmlText) {\n    return htmlText.replace(/<img[^>]*src=[\"']?([^>\"']+)[\"']?[^>]*>/gim, '')\n}\n\nexport function getContentImage(contentItem, options={}){\n\n    const defaultOptions = {\n        imageWidth: 500,\n        mode: 'regexp',\n        thumbnail: false,\n        fallback: true\n    }\n\n    options = {\n        ...defaultOptions,\n        ...options\n    }\n\n    const {imageWidth, mode, thumbnail, fallback} = options\n\n    return getCacheableImage(findContentImage(contentItem, mode, fallback), imageWidth, thumbnail)\n}\n\nexport function jsonCopy (obj) {\n    if (typeof obj !== 'object') return null\n    try {\n        return JSON.parse(JSON.stringify(obj))\n    } catch (error) {\n        console.error('Warning! Argument is not a valid JSON. Details:', error)\n    }\n}\n\nexport function isEmptyObject (obj){\n    if (typeof obj !== 'object') return null\n    return Object.keys(obj).length === 0\n}\n\nconst utils = {\n    pause,\n    unescapeHtmlEntities,\n    splitArray,\n    abridge,\n    getCacheableImage,\n    findContentImage,\n    getContentImage,\n    getImagelessHTML,\n    jsonCopy,\n    isEmptyObject\n}\n\nexport default utils"]}