{"version":3,"sources":["utils.es6"],"names":["jQuery","window","unescapeHtmlEntities","text","Error","temp","document","createElement","innerHTML","innerText","textContent","pause","ms","Promise","resolve","setTimeout","splitArray","array","chunksNumber","Array","newArray","i","push","undefined","length","chunkLength","Math","ceil","forEach","item","chunkNumber","floor","sliceArray","sliceSize","sourceArray","targetArrayOfArrays","splice","abridge","newText","slice","match","words","split","join","replace","getCacheableImage","initialImageURL","imageWidth","thumbnail","jiveStorageResult","imageNumberChunks","imageID","findContentImage","contentItem","mode","fallback","content","includes","image","getFromApi","contentImages","ref","thumbnailURL","find","attr","regexp","RegExp","matches","imagesArray","exec","getImagelessHTML","htmlText","getContentImage","options","defaultOptions","jsonCopy","obj","JSON","parse","stringify","error","console","isEmptyObject","Object","keys","utils"],"mappings":"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","sourcesContent":["const jQuery = window.jQuery\n\nexport function unescapeHtmlEntities (text) {\n  if (typeof text !== 'string') throw new Error('Argument should be a string')\n\n  const temp = document.createElement('div')\n  temp.innerHTML = text //.replace(/<|&lt;/gi, '‹').replace(/>|&gt;/gi, '›')\n  return temp.innerText || temp.textContent\n}\n\nexport function pause (ms = 0) {\n  if (typeof ms !== 'number') throw new Error('Expected parameter to be a number')\n  if (ms < 0) throw new Error('We can\\'t do time travel :) Please input a positive number or 0')\n\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nexport function splitArray (array, chunksNumber) {\n  if (!(array instanceof Array)) throw new Error('1st argument should be an array')\n  if (typeof chunksNumber !== 'number') throw new Error('2nd argument should be a number')\n  if (chunksNumber <= 0) return []\n  if (chunksNumber === 1) return array\n\n  const newArray = []\n\n  for (let i = 0; i < chunksNumber; i++) {\n    newArray.push([])\n  }\n\n  if (array !== undefined && array.length) {\n    const chunkLength = Math.ceil(array.length / chunksNumber)\n\n    array.forEach((item, i) => {\n      const chunkNumber = Math.floor(i / chunkLength)\n      newArray[chunkNumber].push(item)\n    })\n  }\n\n  return newArray\n}\n\nexport function sliceArray (array, sliceSize) {\n  if (!(array instanceof Array)) throw new Error('1st argument should be an array')\n  if (typeof sliceSize !== 'number') throw new Error('2nd argument should be a number')\n  if (sliceSize <= 0) throw new Error('2nd argument should 1 or more')\n  if (sliceSize >= array.length) return [array]\n\n  const sourceArray = [...array]\n  const targetArrayOfArrays = []\n\n  while (sourceArray.length) {\n    targetArrayOfArrays.push(sourceArray.splice(0, sliceSize))\n  }\n\n  return targetArrayOfArrays\n}\n\nexport function abridge (text, length = 160) {\n\n  if (typeof text !== 'string') {\n    throw new Error(`\"abridge\" 1st argument must be a string (${typeof text} given)`)\n  }\n\n  //if it's less than limit - just return it\n  if (text.length <= length) return text\n\n  let newText = text.slice(0, length)\n\n  // if the next symbol is not a whitespace and not a punctuation - remove last word\n  if (!text[length].match(/\\s|\\.|,|:|;|!|\\?/)) {\n\n    let words = newText.split(' ')\n\n    //remove last word (cause it can be broken, or too long in case of a link)\n    if (words.length > 1) {\n      words = words.slice(0, words.length - 1)\n    }\n\n    newText = words.join(' ')\n  }\n\n  // remove commas and dots from a last word\n  newText = newText.replace(/(\\.|,|;|:)$/, '')\n\n  return newText + '...'\n}\n\nexport function getCacheableImage (initialImageURL, imageWidth = 500, thumbnail = false) {\n\n  //return initialImageURL\n  if (!initialImageURL) return initialImageURL\n\n  if (typeof initialImageURL !== 'string') {\n    throw new Error('1st argument should be falsy value or string')\n  }\n  if (typeof imageWidth !== 'undefined' && typeof imageWidth !== 'number') {\n    throw new Error('2nd argument should be a number if defined')\n  }\n\n  const jiveStorageResult =\n    initialImageURL.match(/(.+)servlet\\/JiveServlet\\/(downloadImage|previewBody)\\/([\\d-]+)\\/(.+)/i)\n\n  //console.log('jiveStorageResult', jiveStorageResult)\n\n  if (!jiveStorageResult || !jiveStorageResult[3]) return initialImageURL\n\n  //get jive image ID from URL\n  const imageNumberChunks = jiveStorageResult[3].split('-')\n  const imageID = imageNumberChunks[imageNumberChunks.length - 1]\n\n  switch (jiveStorageResult[2]) {\n    case 'downloadImage':\n      return jiveStorageResult[1]\n        + 'api/core/v3/images/' + imageID + '?width=' + imageWidth\n        + (thumbnail ? '&thumbnail=true' : '')\n    case 'previewBody':\n      return jiveStorageResult[1]\n        + 'servlet/JiveServlet?bodyImage=true&contentType=image&maxWidth=500&maxHeight=300'\n        + '&binaryBodyID=' + imageID\n  }\n}\n\nexport function findContentImage (contentItem, mode = 'regexp', fallback = true) {\n\n  if (!contentItem || !contentItem.content || !contentItem.content.text) return null\n\n  if (typeof mode !== 'undefined' && !['regexp', 'api', 'jquery'].includes(mode)) {\n    throw new Error('2nd argument should be \"regexp\"|\"api\"|\"jquery\"')\n  }\n\n  let image\n\n  function getFromApi () {\n    if (contentItem.contentImages && contentItem.contentImages.length) {\n      return contentItem.contentImages[0].ref\n    } else if (contentItem.thumbnailURL) {\n      return contentItem.thumbnailURL\n    }\n    return false\n  }\n\n  switch (mode) {\n    case 'api':\n      // version 1: take from API. Downside: API images list never updates after content creation\n      image = getFromApi()\n      break\n    case 'jquery':\n      //version 2: find image links with jQuery. Downside: it requests all the images content item has\n      image = jQuery ? jQuery(contentItem.content.text).find('img').attr('src') : false\n      break\n    case 'regexp':\n      //version 3: Find image URLs by regExp\n      //regexp: <img[^>]*src=[\"']?([^>\"']+)[\"']?[^>]*>\n      const regexp = RegExp('<img[^>]*src=[\"\\']?([^>\"\\']+)[\"\\']?[^>]*>', 'gim')\n\n      let matches\n      let imagesArray = []\n      while ((matches = regexp.exec(contentItem.content.text)) !== null) {\n        if (!matches[0].match(/class=[\"'][^\"']*emoticon-inline/im)) {\n          imagesArray.push(matches[1])\n        }\n      }\n\n      image = (imagesArray.length) ? imagesArray[0] : false\n      break\n  }\n\n  if (!image && mode !== 'api' && fallback) {\n    image = getFromApi()\n  }\n\n  return image\n}\n\nexport function getImagelessHTML (htmlText) {\n  return htmlText.replace(/<img[^>]*src=[\"']?([^>\"']+)[\"']?[^>]*>/gim, '')\n}\n\nexport function getContentImage (contentItem, options = {}) {\n\n  const defaultOptions = {\n    imageWidth: 500,\n    mode: 'regexp',\n    thumbnail: false,\n    fallback: true\n  }\n\n  options = {\n    ...defaultOptions,\n    ...options\n  }\n\n  const { imageWidth, mode, thumbnail, fallback } = options\n\n  return getCacheableImage(findContentImage(contentItem, mode, fallback), imageWidth, thumbnail)\n}\n\nexport function jsonCopy (obj) {\n  if (typeof obj !== 'object') return null\n  try {\n    return JSON.parse(JSON.stringify(obj))\n  } catch (error) {\n    console.error('Warning! Argument is not a valid JSON. Details:', error)\n  }\n}\n\nexport function isEmptyObject (obj) {\n  if (typeof obj !== 'object') return null\n  return Object.keys(obj).length === 0\n}\n\nconst utils = {\n  pause,\n  unescapeHtmlEntities,\n  splitArray,\n  abridge,\n  getCacheableImage,\n  findContentImage,\n  getContentImage,\n  getImagelessHTML,\n  jsonCopy,\n  isEmptyObject\n}\n\nexport default utils"],"file":"utils.js"}